
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>sympy.algebras.quaternion &#8212; SymPy 1.5.dev documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-core.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-autocomplete.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-sphinx.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-sphinx.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML-full"></script>
    
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link href="https://docs.sympy.org/latest/_modules/sympy/algebras/quaternion.html" rel="canonical" />
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.5.dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sympy.algebras.quaternion</h1><div class="highlight"><pre>
<span></span><span class="c1"># References :</span>
<span class="c1"># http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/</span>
<span class="c1"># https://en.wikipedia.org/wiki/Quaternion</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">Rational</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">re</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">conjugate</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">ln</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">trigsimp</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Mul</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">sympify</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="k">import</span> <span class="n">SYMPY_INTS</span>
<span class="kn">from</span> <span class="nn">sympy.core.expr</span> <span class="k">import</span> <span class="n">Expr</span>
<span class="kn">from</span> <span class="nn">sympy.core.numbers</span> <span class="k">import</span> <span class="n">Integer</span>


<div class="viewcode-block" id="Quaternion"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion">[docs]</a><span class="k">class</span> <span class="nc">Quaternion</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provides basic quaternion operations.</span>
<span class="sd">    Quaternion objects can be instantiated as Quaternion(a, b, c, d)</span>
<span class="sd">    as in (a + b*i + c*j + d*k).</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">    &gt;&gt;&gt; q = Quaternion(1, 2, 3, 4)</span>
<span class="sd">    &gt;&gt;&gt; q</span>
<span class="sd">    1 + 2*i + 3*j + 4*k</span>

<span class="sd">    Quaternions over complex fields can be defined as :</span>

<span class="sd">    &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">    &gt;&gt;&gt; from sympy import symbols, I</span>
<span class="sd">    &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">    &gt;&gt;&gt; q1 = Quaternion(x, x**3, x, x**2, real_field = False)</span>
<span class="sd">    &gt;&gt;&gt; q2 = Quaternion(3 + 4*I, 2 + 5*I, 0, 7 + 8*I, real_field = False)</span>
<span class="sd">    &gt;&gt;&gt; q1</span>
<span class="sd">    x + x**3*i + x*j + x**2*k</span>
<span class="sd">    &gt;&gt;&gt; q2</span>
<span class="sd">    (3 + 4*I) + (2 + 5*I)*i + 0*j + (7 + 8*I)*k</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_op_priority</span> <span class="o">=</span> <span class="mf">11.0</span>

    <span class="n">is_commutative</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">real_field</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">is_commutative</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;arguments have to be commutative&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">Expr</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_c</span> <span class="o">=</span> <span class="n">c</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_d</span> <span class="o">=</span> <span class="n">d</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_real_field</span> <span class="o">=</span> <span class="n">real_field</span>
            <span class="k">return</span> <span class="n">obj</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_d</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">real_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real_field</span>

<div class="viewcode-block" id="Quaternion.from_axis_angle"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.from_axis_angle">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_axis_angle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vector</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a rotation quaternion given the axis and the angle of rotation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        vector : tuple of three numbers</span>
<span class="sd">            The vector representation of the given axis.</span>
<span class="sd">        angle : number</span>
<span class="sd">            The angle by which axis is rotated (in radians).</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The normalized rotation quaternion calculated from the given axis and the angle of rotation.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import pi, sqrt</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion.from_axis_angle((sqrt(3)/3, sqrt(3)/3, sqrt(3)/3), 2*pi/3)</span>
<span class="sd">        &gt;&gt;&gt; q</span>
<span class="sd">        1/2 + 1/2*i + 1/2*j + 1/2*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">norm</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="n">norm</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">s</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">s</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">s</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span></div>

<div class="viewcode-block" id="Quaternion.from_rotation_matrix"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.from_rotation_matrix">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_rotation_matrix</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the equivalent quaternion of a matrix. The quaternion will be normalized</span>
<span class="sd">        only if the matrix is special orthogonal (orthogonal and det(M) = 1).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        M : Matrix</span>
<span class="sd">            Input matrix to be converted to equivalent quaternion. M must be special</span>
<span class="sd">            orthogonal (orthogonal and det(M) = 1) for the quaternion to be normalized.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The quaternion equivalent to given matrix.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import Matrix, symbols, cos, sin, trigsimp</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; M = Matrix([[cos(x), -sin(x), 0], [sin(x), cos(x), 0], [0, 0, 1]])</span>
<span class="sd">        &gt;&gt;&gt; q = trigsimp(Quaternion.from_rotation_matrix(M))</span>
<span class="sd">        &gt;&gt;&gt; q</span>
<span class="sd">        sqrt(2)*sqrt(cos(x) + 1)/2 + 0*i + 0*j + sqrt(2 - 2*cos(x))/2*k</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">absQ</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">det</span><span class="p">()</span><span class="o">**</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">absQ</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">absQ</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">absQ</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">absQ</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">__copysign</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">__copysign</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">__copysign</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__copysign</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>

        <span class="c1"># Takes the sign from the second term and sets the sign of the first</span>
        <span class="c1"># without altering the magnitude.</span>

        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_mul</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_a</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_b</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_Integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">symbols</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;evaluate&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="o">*</span><span class="n">symbols</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

<div class="viewcode-block" id="Quaternion.add"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds quaternions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        other : Quaternion</span>
<span class="sd">            The quaternion to add to current (self) quaternion.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The resultant quaternion after adding self to other</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q2 = Quaternion(5, 6, 7, 8)</span>
<span class="sd">        &gt;&gt;&gt; q1.add(q2)</span>
<span class="sd">        6 + 8*i + 10*j + 12*k</span>
<span class="sd">        &gt;&gt;&gt; q1 + 5</span>
<span class="sd">        6 + 2*i + 3*j + 4*k</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;, real = True)</span>
<span class="sd">        &gt;&gt;&gt; q1.add(x)</span>
<span class="sd">        (x + 1) + 2*i + 3*j + 4*k</span>

<span class="sd">        Quaternions over complex fields :</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import I</span>
<span class="sd">        &gt;&gt;&gt; q3 = Quaternion(3 + 4*I, 2 + 5*I, 0, 7 + 8*I, real_field = False)</span>
<span class="sd">        &gt;&gt;&gt; q3.add(2 + 3*I)</span>
<span class="sd">        (5 + 7*I) + (2 + 5*I)*i + 0*j + (7 + 8*I)*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="c1"># If q2 is a number or a sympy expression instead of a quaternion</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">q1</span><span class="o">.</span><span class="n">real_field</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">q2</span><span class="o">.</span><span class="n">is_complex</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">im</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># q2 is something strange, do not evaluate:</span>
                    <span class="k">return</span> <span class="n">Add</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">q1</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span> <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span>
                          <span class="o">+</span> <span class="n">q2</span><span class="o">.</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="Quaternion.mul"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.mul">[docs]</a>    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiplies quaternions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        other : Quaternion or symbol</span>
<span class="sd">            The quaternion to multiply to current (self) quaternion.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The resultant quaternion after multiplying self with other</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q2 = Quaternion(5, 6, 7, 8)</span>
<span class="sd">        &gt;&gt;&gt; q1.mul(q2)</span>
<span class="sd">        (-60) + 12*i + 30*j + 24*k</span>
<span class="sd">        &gt;&gt;&gt; q1.mul(2)</span>
<span class="sd">        2 + 4*i + 6*j + 8*k</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;, real = True)</span>
<span class="sd">        &gt;&gt;&gt; q1.mul(x)</span>
<span class="sd">        x + 2*x*i + 3*x*j + 4*x*k</span>

<span class="sd">        Quaternions over complex fields :</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import I</span>
<span class="sd">        &gt;&gt;&gt; q3 = Quaternion(3 + 4*I, 2 + 5*I, 0, 7 + 8*I, real_field = False)</span>
<span class="sd">        &gt;&gt;&gt; q3.mul(2 + 3*I)</span>
<span class="sd">        (2 + 3*I)*(3 + 4*I) + (2 + 3*I)*(2 + 5*I)*i + 0*j + (2 + 3*I)*(7 + 8*I)*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generic_mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_generic_mul</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generic multiplication.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        q1 : Quaternion or symbol</span>
<span class="sd">        q2 : Quaternion or symbol</span>

<span class="sd">        It&#39;s important to note that if neither q1 nor q2 is a Quaternion,</span>
<span class="sd">        this function simply returns q1 * q2.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The resultant quaternion after multiplying q1 and q2</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1 = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q2 = Quaternion(5, 6, 7, 8)</span>
<span class="sd">        &gt;&gt;&gt; Quaternion._generic_mul(q1, q2)</span>
<span class="sd">        (-60) + 12*i + 30*j + 24*k</span>
<span class="sd">        &gt;&gt;&gt; Quaternion._generic_mul(q1, 2)</span>
<span class="sd">        2 + 4*i + 6*j + 8*k</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;, real = True)</span>
<span class="sd">        &gt;&gt;&gt; Quaternion._generic_mul(q1, x)</span>
<span class="sd">        x + 2*x*i + 3*x*j + 4*x*k</span>

<span class="sd">        Quaternions over complex fields :</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import I</span>
<span class="sd">        &gt;&gt;&gt; q3 = Quaternion(3 + 4*I, 2 + 5*I, 0, 7 + 8*I, real_field = False)</span>
<span class="sd">        &gt;&gt;&gt; Quaternion._generic_mul(q3, 2 + 3*I)</span>
<span class="sd">        (2 + 3*I)*(3 + 4*I) + (2 + 3*I)*(2 + 5*I)*i + 0*j + (2 + 3*I)*(7 + 8*I)*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>

        <span class="c1"># None is a Quaternion:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span>

        <span class="c1"># If q1 is a number or a sympy expression instead of a quaternion</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">q2</span><span class="o">.</span><span class="n">real_field</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">q1</span><span class="o">.</span><span class="n">is_complex</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">im</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>


        <span class="c1"># If q2 is a number or a sympy expression instead of a quaternion</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">q1</span><span class="o">.</span><span class="n">real_field</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">q2</span><span class="o">.</span><span class="n">is_complex</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">re</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="n">im</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Mul</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">q2</span> <span class="o">*</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="o">-</span><span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">b</span> <span class="o">-</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
                          <span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">c</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                          <span class="n">q1</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">q1</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q2</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">q1</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">q2</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_eval_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the conjugate of the quaternion.&quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>

<div class="viewcode-block" id="Quaternion.norm"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.norm">[docs]</a>    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the norm of the quaternion.&quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="c1"># trigsimp is used to simplify sin(x)^2 + cos(x)^2 (these terms</span>
        <span class="c1"># arise when from_axis_angle is used).</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">trigsimp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span></div>

<div class="viewcode-block" id="Quaternion.normalize"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.normalize">[docs]</a>    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the normalized form of the quaternion.&quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">())</span></div>

<div class="viewcode-block" id="Quaternion.inverse"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.inverse">[docs]</a>    <span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the inverse of the quaternion.&quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compute inverse for a quaternion with zero norm&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Quaternion.pow"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.pow">[docs]</a>    <span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds the pth power of the quaternion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        p : int</span>
<span class="sd">            Power to be applied on quaternion.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            Returns the p-th power of the current quaternion.</span>
<span class="sd">            Returns the inverse if p = -1.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q.pow(4)</span>
<span class="sd">        668 + (-224)*i + (-336)*j + (-448)*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">q</span><span class="o">.</span><span class="n">inverse</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">inverse</span><span class="p">(),</span> <span class="o">-</span><span class="n">p</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">SYMPY_INTS</span><span class="p">))):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="k">while</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">res</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">q</span>

        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Quaternion.exp"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.exp">[docs]</a>    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the exponential of q (e^q).</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            Exponential of q (e^q).</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q.exp()</span>
<span class="sd">        E*cos(sqrt(29))</span>
<span class="sd">        + 2*sqrt(29)*E*sin(sqrt(29))/29*i</span>
<span class="sd">        + 3*sqrt(29)*E*sin(sqrt(29))/29*j</span>
<span class="sd">        + 4*sqrt(29)*E*sin(sqrt(29))/29*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># exp(q) = e^a(cos||v|| + v/||v||*sin||v||)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">vector_norm</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">vector_norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="n">vector_norm</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">vector_norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">vector_norm</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">vector_norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">/</span> <span class="n">vector_norm</span>

        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_ln</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the natural logarithm of the quaternion (_ln(q)).</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q._ln()</span>
<span class="sd">        log(sqrt(30))</span>
<span class="sd">        + 2*sqrt(29)*acos(sqrt(30)/30)/29*i</span>
<span class="sd">        + 3*sqrt(29)*acos(sqrt(30)/30)/29*j</span>
<span class="sd">        + 4*sqrt(29)*acos(sqrt(30)/30)/29*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># _ln(q) = _ln||q|| + v/||v||*arccos(a/||q||)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">q_norm</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ln</span><span class="p">(</span><span class="n">q_norm</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">acos</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">q_norm</span><span class="p">)</span> <span class="o">/</span> <span class="n">vector_norm</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">acos</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">q_norm</span><span class="p">)</span> <span class="o">/</span> <span class="n">vector_norm</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">acos</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">q_norm</span><span class="p">)</span> <span class="o">/</span> <span class="n">vector_norm</span>

        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

<div class="viewcode-block" id="Quaternion.pow_cos_sin"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.pow_cos_sin">[docs]</a>    <span class="k">def</span> <span class="nf">pow_cos_sin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the pth power in the cos-sin form.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        p : int</span>
<span class="sd">            Power to be applied on quaternion.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        Quaternion</span>
<span class="sd">            The p-th power in the cos-sin form.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(1, 2, 3, 4)</span>
<span class="sd">        &gt;&gt;&gt; q.pow_cos_sin(4)</span>
<span class="sd">        900*cos(4*acos(sqrt(30)/30))</span>
<span class="sd">        + 1800*sqrt(29)*sin(4*acos(sqrt(30)/30))/29*i</span>
<span class="sd">        + 2700*sqrt(29)*sin(4*acos(sqrt(30)/30))/29*j</span>
<span class="sd">        + 3600*sqrt(29)*sin(4*acos(sqrt(30)/30))/29*k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># q = ||q||*(cos(a) + u*sin(a))</span>
        <span class="c1"># q^p = ||q||^p * (cos(p*a) + u*sin(p*a))</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">to_axis_angle</span><span class="p">()</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">from_axis_angle</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">*</span> <span class="n">angle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q2</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">**</span><span class="n">p</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1"># TODO: is this expression correct?</span>
        <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span>
                          <span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>

<div class="viewcode-block" id="Quaternion.rotate_point"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.rotate_point">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rotate_point</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the coordinates of the point pin(a 3 tuple) after rotation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        pin : tuple</span>
<span class="sd">            A 3-element tuple of coordinates of a point. This point will be</span>
<span class="sd">            the axis of rotation.</span>
<span class="sd">        r</span>
<span class="sd">            Angle to be rotated.</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        tuple</span>
<span class="sd">            The coordinates of the quaternion after rotation.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, trigsimp, cos, sin</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(cos(x/2), 0, 0, sin(x/2))</span>
<span class="sd">        &gt;&gt;&gt; trigsimp(Quaternion.rotate_point((1, 1, 1), q))</span>
<span class="sd">        (sqrt(2)*cos(x + pi/4), sqrt(2)*sin(x + pi/4), 1)</span>
<span class="sd">        &gt;&gt;&gt; (axis, angle) = q.to_axis_angle()</span>
<span class="sd">        &gt;&gt;&gt; trigsimp(Quaternion.rotate_point((1, 1, 1), (axis, angle)))</span>
<span class="sd">        (sqrt(2)*cos(x + pi/4), sqrt(2)*sin(x + pi/4), 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># if r is of the form (vector, angle)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">from_axis_angle</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if r is a quaternion</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
        <span class="n">pout</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">Quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pin</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">conjugate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">pout</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">pout</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">pout</span><span class="o">.</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="Quaternion.to_axis_angle"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.to_axis_angle">[docs]</a>    <span class="k">def</span> <span class="nf">to_axis_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the axis and angle of rotation of a quaternion</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        tuple</span>
<span class="sd">            Tuple of (axis, angle)</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(1, 1, 1, 1)</span>
<span class="sd">        &gt;&gt;&gt; (axis, angle) = q.to_axis_angle()</span>
<span class="sd">        &gt;&gt;&gt; axis</span>
<span class="sd">        (sqrt(3)/3, sqrt(3)/3, sqrt(3)/3)</span>
<span class="sd">        &gt;&gt;&gt; angle</span>
<span class="sd">        2*pi/3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Skips it if it doesn&#39;t know whether q.a is negative</span>
            <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># avoid error with acos</span>
                <span class="c1"># axis and angle of rotation of q and q*-1 will be the same</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">acos</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>

        <span class="c1"># Since quaternion is normalised, q.a is less than 1.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Quaternion.to_rotation_matrix"><a class="viewcode-back" href="../../../modules/algebras.html#sympy.algebras.Quaternion.to_rotation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">to_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the equivalent rotation transformation matrix of the quaternion</span>
<span class="sd">        which represents rotation about the origin if v is not passed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        v : tuple or None</span>
<span class="sd">            Default value: None</span>

<span class="sd">        Returns</span>
<span class="sd">        =======</span>

<span class="sd">        tuple</span>
<span class="sd">            Returns the equivalent rotation transformation matrix of the quaternion</span>
<span class="sd">            which represents rotation about the origin if v is not passed.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, trigsimp, cos, sin</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(cos(x/2), 0, 0, sin(x/2))</span>
<span class="sd">        &gt;&gt;&gt; trigsimp(q.to_rotation_matrix())</span>
<span class="sd">        Matrix([</span>
<span class="sd">        [cos(x), -sin(x), 0],</span>
<span class="sd">        [sin(x),  cos(x), 0],</span>
<span class="sd">        [     0,       0, 1]])</span>

<span class="sd">        Generates a 4x4 transformation matrix (used for rotation about a point</span>
<span class="sd">        other than the origin) if the point(v) is passed as an argument.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.algebras.quaternion import Quaternion</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols, trigsimp, cos, sin</span>
<span class="sd">        &gt;&gt;&gt; x = symbols(&#39;x&#39;)</span>
<span class="sd">        &gt;&gt;&gt; q = Quaternion(cos(x/2), 0, 0, sin(x/2))</span>
<span class="sd">        &gt;&gt;&gt; trigsimp(q.to_rotation_matrix((1, 1, 1)))</span>
<span class="sd">         Matrix([</span>
<span class="sd">        [cos(x), -sin(x), 0,  sin(x) - cos(x) + 1],</span>
<span class="sd">        [sin(x),  cos(x), 0, -sin(x) - cos(x) + 1],</span>
<span class="sd">        [     0,       0, 1,                    0],</span>
<span class="sd">        [     0,       0, 0,                    1]])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span><span class="o">**-</span><span class="mi">2</span>
        <span class="n">m00</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">m01</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m02</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>

        <span class="n">m10</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">c</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m11</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">m12</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>

        <span class="n">m20</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m21</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">d</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="n">m22</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">m00</span><span class="p">,</span> <span class="n">m01</span><span class="p">,</span> <span class="n">m02</span><span class="p">],</span> <span class="p">[</span><span class="n">m10</span><span class="p">,</span> <span class="n">m11</span><span class="p">,</span> <span class="n">m12</span><span class="p">],</span> <span class="p">[</span><span class="n">m20</span><span class="p">,</span> <span class="n">m21</span><span class="p">,</span> <span class="n">m22</span><span class="p">]])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span>

            <span class="n">m03</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">m00</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">m01</span> <span class="o">-</span> <span class="n">z</span><span class="o">*</span><span class="n">m02</span>
            <span class="n">m13</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">m10</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">m11</span> <span class="o">-</span> <span class="n">z</span><span class="o">*</span><span class="n">m12</span>
            <span class="n">m23</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">m20</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">m21</span> <span class="o">-</span> <span class="n">z</span><span class="o">*</span><span class="n">m22</span>
            <span class="n">m30</span> <span class="o">=</span> <span class="n">m31</span> <span class="o">=</span> <span class="n">m32</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">m33</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="k">return</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">m00</span><span class="p">,</span> <span class="n">m01</span><span class="p">,</span> <span class="n">m02</span><span class="p">,</span> <span class="n">m03</span><span class="p">],</span> <span class="p">[</span><span class="n">m10</span><span class="p">,</span> <span class="n">m11</span><span class="p">,</span> <span class="n">m12</span><span class="p">,</span> <span class="n">m13</span><span class="p">],</span>
                          <span class="p">[</span><span class="n">m20</span><span class="p">,</span> <span class="n">m21</span><span class="p">,</span> <span class="n">m22</span><span class="p">,</span> <span class="n">m23</span><span class="p">],</span> <span class="p">[</span><span class="n">m30</span><span class="p">,</span> <span class="n">m31</span><span class="p">,</span> <span class="n">m32</span><span class="p">,</span> <span class="n">m33</span><span class="p">]])</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.5.dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019 SymPy Development Team.
      Last updated on Apr 14, 2019.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.
    </div>
  </body>
</html>