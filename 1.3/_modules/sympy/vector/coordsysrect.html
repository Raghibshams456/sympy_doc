
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sympy.vector.coordsysrect &#8212; SymPy 1.3 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-core.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-autocomplete.css" />
    <link rel="stylesheet" type="text/css" href="https://live.sympy.org/static/live-sphinx.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="https://live.sympy.org/static/live-sphinx.js"></script>
    
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link href="http://docs.sympy.org/latest/_modules/sympy/vector/coordsysrect.html" rel="canonical" />
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sympy.vector.coordsysrect</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sympy.utilities.exceptions</span> <span class="k">import</span> <span class="n">SymPyDeprecationWarning</span>
<span class="kn">from</span> <span class="nn">sympy.core.basic</span> <span class="k">import</span> <span class="n">Basic</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="k">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">sympy.core.cache</span> <span class="k">import</span> <span class="n">cacheit</span>
<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="k">import</span> <span class="n">S</span><span class="p">,</span> <span class="n">Dummy</span><span class="p">,</span> <span class="n">Lambda</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">MatrixBase</span><span class="p">,</span> <span class="n">ImmutableDenseMatrix</span>
<span class="kn">from</span> <span class="nn">sympy.solvers</span> <span class="k">import</span> <span class="n">solve</span>
<span class="kn">from</span> <span class="nn">sympy.vector.scalar</span> <span class="k">import</span> <span class="n">BaseScalar</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="n">eye</span><span class="p">,</span> <span class="n">trigsimp</span><span class="p">,</span> <span class="n">ImmutableMatrix</span> <span class="k">as</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span>\
    <span class="n">sqrt</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">simplify</span>
<span class="kn">import</span> <span class="nn">sympy.vector</span>
<span class="kn">from</span> <span class="nn">sympy.vector.orienters</span> <span class="k">import</span> <span class="p">(</span><span class="n">Orienter</span><span class="p">,</span> <span class="n">AxisOrienter</span><span class="p">,</span> <span class="n">BodyOrienter</span><span class="p">,</span>
                                    <span class="n">SpaceOrienter</span><span class="p">,</span> <span class="n">QuaternionOrienter</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">CoordSysCartesian</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">SymPyDeprecationWarning</span><span class="p">(</span>
        <span class="n">feature</span><span class="o">=</span><span class="s2">&quot;CoordSysCartesian&quot;</span><span class="p">,</span>
        <span class="n">useinstead</span><span class="o">=</span><span class="s2">&quot;CoordSys3D&quot;</span><span class="p">,</span>
        <span class="n">issue</span><span class="o">=</span><span class="mi">12865</span><span class="p">,</span>
        <span class="n">deprecated_since_version</span><span class="o">=</span><span class="s2">&quot;1.1&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">warn</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">CoordSys3D</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="CoordSys3D"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D">[docs]</a><span class="k">class</span> <span class="nc">CoordSys3D</span><span class="p">(</span><span class="n">Basic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a coordinate system in 3-D space.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">rotation_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The orientation/location parameters are necessary if this system</span>
<span class="sd">        is being defined at a certain orientation or location wrt another.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : str</span>
<span class="sd">            The name of the new CoordSys3D instance.</span>

<span class="sd">        transformation : Lambda, Tuple, str</span>
<span class="sd">            Transformation defined by transformation equations or chosen</span>
<span class="sd">            from predefined ones.</span>

<span class="sd">        location : Vector</span>
<span class="sd">            The position vector of the new system&#39;s origin wrt the parent</span>
<span class="sd">            instance.</span>

<span class="sd">        rotation_matrix : SymPy ImmutableMatrix</span>
<span class="sd">            The rotation matrix of the new coordinate system with respect</span>
<span class="sd">            to the parent. In other words, the output of</span>
<span class="sd">            new_system.rotation_matrix(parent).</span>

<span class="sd">        parent : CoordSys3D</span>
<span class="sd">            The coordinate system wrt which the orientation/location</span>
<span class="sd">            (or both) is being defined.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">Vector</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">Vector</span>
        <span class="n">BaseVector</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">BaseVector</span>
        <span class="n">Point</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">Point</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name should be a string&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rotation_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;specify either `transformation` or &quot;</span>
                                 <span class="s2">&quot;`location`/`rotation_matrix`&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="p">(</span><span class="n">Tuple</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MatrixBase</span><span class="p">):</span>
                    <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">transformation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">transformation</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">transformation</span> <span class="o">=</span> <span class="n">Lambda</span><span class="p">(</span><span class="n">transformation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="n">transformation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x1 x2 x3&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">Dummy</span><span class="p">)</span>
                <span class="n">transformation</span> <span class="o">=</span> <span class="n">Lambda</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">),</span>
                                        <span class="n">transformation</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">transformation</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">transformation</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="p">(</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">)):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;transformation: &quot;</span>
                                <span class="s2">&quot;wrong type </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">transformation</span><span class="p">)))</span>

        <span class="c1"># If orientation information has been provided, store</span>
        <span class="c1"># the rotation matrix accordingly</span>
        <span class="k">if</span> <span class="n">rotation_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">ImmutableDenseMatrix</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">MatrixBase</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;rotation_matrix should be an Immutable&quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;Matrix instance&quot;</span><span class="p">)</span>
            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">rotation_matrix</span><span class="o">.</span><span class="n">as_immutable</span><span class="p">()</span>

        <span class="c1"># If location information is not given, adjust the default</span>
        <span class="c1"># location as Vector.zero</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">CoordSys3D</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;parent should be a &quot;</span> <span class="o">+</span>
                                <span class="s2">&quot;CoordSys3D/None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="o">.</span><span class="n">zero</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;location should be a Vector&quot;</span><span class="p">)</span>
                <span class="c1"># Check that location does not contain base</span>
                <span class="c1"># scalars</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">free_symbols</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">BaseScalar</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;location should not contain&quot;</span> <span class="o">+</span>
                                         <span class="s2">&quot; BaseScalars&quot;</span><span class="p">)</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">locate_new</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.origin&#39;</span><span class="p">,</span>
                                              <span class="n">location</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">Vector</span><span class="o">.</span><span class="n">zero</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.origin&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transformation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transformation</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">(</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>
            <span class="n">lambda_transformation</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_compose_rotation_and_translation</span><span class="p">(</span>
                <span class="n">transformation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">transformation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">parent</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">transformation</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">_projections</span>
            <span class="n">lambda_lame</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_get_lame_coeff</span><span class="p">(</span><span class="s1">&#39;cartesian&#39;</span><span class="p">)</span>
            <span class="n">lambda_inverse</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span><span class="o">*</span><span class="n">Matrix</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">-</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">-</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">):</span>
            <span class="n">trname</span> <span class="o">=</span> <span class="n">transformation</span><span class="o">.</span><span class="n">name</span>
            <span class="n">lambda_transformation</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_get_transformation_lambdas</span><span class="p">(</span><span class="n">trname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">lame_coefficients</span><span class="p">()</span> <span class="o">!=</span> <span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">S</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parent for pre-defined coordinate &#39;</span>
                                 <span class="s1">&#39;system should be Cartesian.&#39;</span><span class="p">)</span>
            <span class="n">lambda_lame</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_get_lame_coeff</span><span class="p">(</span><span class="n">trname</span><span class="p">)</span>
            <span class="n">lambda_inverse</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_set_inv_trans_equations</span><span class="p">(</span><span class="n">trname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_check_orthogonality</span><span class="p">(</span><span class="n">transformation</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The transformation equation does not &quot;</span>
                                 <span class="s2">&quot;create orthogonal coordinate system&quot;</span><span class="p">)</span>
            <span class="n">lambda_transformation</span> <span class="o">=</span> <span class="n">transformation</span>
            <span class="n">lambda_lame</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_calculate_lame_coeff</span><span class="p">(</span><span class="n">lambda_transformation</span><span class="p">)</span>
            <span class="n">lambda_inverse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lambda_transformation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">transformation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
            <span class="n">lambda_lame</span> <span class="o">=</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_get_lame_coeff</span><span class="p">(</span><span class="n">transformation</span><span class="p">)</span>
            <span class="n">lambda_inverse</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">variable_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">):</span>
                <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="s2">&quot;x3&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transformation</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">transformation</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
                    <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;phi&quot;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">transformation</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="s1">&#39;cylindrical&#39;</span><span class="p">:</span>
                    <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">vector_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vector_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]</span>

        <span class="c1"># All systems that are defined as &#39;roots&#39; are unequal, unless</span>
        <span class="c1"># they have the same name.</span>
        <span class="c1"># Systems defined at same orientation/position wrt the same</span>
        <span class="c1"># &#39;parent&#39; are equal, irrespective of the name.</span>
        <span class="c1"># This is true even if the same orientation is provided via</span>
        <span class="c1"># different methods like Axis/Body/Space/Quaternion.</span>
        <span class="c1"># However, coincident systems may be seen as unequal if</span>
        <span class="c1"># positioned/oriented wrt different parents, even though</span>
        <span class="c1"># they may actually be &#39;coincident&#39; wrt the root system.</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CoordSys3D</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CoordSys3D</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">transformation</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># Initialize the base vectors</span>

        <span class="n">_check_strings</span><span class="p">(</span><span class="s1">&#39;vector_names&#39;</span><span class="p">,</span> <span class="n">vector_names</span><span class="p">)</span>
        <span class="n">vector_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vector_names</span><span class="p">)</span>
        <span class="n">latex_vects</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;\mathbf{\hat{</span><span class="si">%s</span><span class="s1">}_{</span><span class="si">%s</span><span class="s1">}}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span>
                           <span class="n">x</span> <span class="ow">in</span> <span class="n">vector_names</span><span class="p">]</span>
        <span class="n">pretty_vects</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vector_names</span><span class="p">]</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_vector_names</span> <span class="o">=</span> <span class="n">vector_names</span>

        <span class="n">v1</span> <span class="o">=</span> <span class="n">BaseVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_vects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latex_vects</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">BaseVector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_vects</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">latex_vects</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">BaseVector</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_vects</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">latex_vects</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_base_vectors</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span>

        <span class="c1"># Initialize the base scalars</span>

        <span class="n">_check_strings</span><span class="p">(</span><span class="s1">&#39;variable_names&#39;</span><span class="p">,</span> <span class="n">vector_names</span><span class="p">)</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variable_names</span><span class="p">)</span>
        <span class="n">latex_scalars</span> <span class="o">=</span> <span class="p">[(</span><span class="sa">r</span><span class="s2">&quot;\mathbf{{</span><span class="si">%s</span><span class="s2">}_{</span><span class="si">%s</span><span class="s2">}}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span>
                         <span class="n">x</span> <span class="ow">in</span> <span class="n">variable_names</span><span class="p">]</span>
        <span class="n">pretty_scalars</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">variable_names</span><span class="p">]</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_variable_names</span> <span class="o">=</span> <span class="n">variable_names</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_vector_names</span> <span class="o">=</span> <span class="n">vector_names</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">BaseScalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_scalars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">latex_scalars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">BaseScalar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_scalars</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">latex_scalars</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">BaseScalar</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">pretty_scalars</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">latex_scalars</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_base_scalars</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_transformation</span> <span class="o">=</span> <span class="n">transformation</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_transformation_lambda</span> <span class="o">=</span> <span class="n">lambda_transformation</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_lame_coefficients</span> <span class="o">=</span> <span class="n">lambda_lame</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_transformation_from_parent_lambda</span> <span class="o">=</span> <span class="n">lambda_inverse</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x2</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">variable_names</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x3</span><span class="p">)</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vector_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vector_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v2</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vector_names</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v3</span><span class="p">)</span>

        <span class="c1"># Assign params</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span> <span class="o">=</span> <span class="n">rotation_matrix</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_origin</span> <span class="o">=</span> <span class="n">origin</span>

        <span class="c1"># Return the instance</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>
    <span class="n">_sympystr</span> <span class="o">=</span> <span class="fm">__str__</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_vectors</span><span class="p">())</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_orthogonality</span><span class="p">(</span><span class="n">equations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method for _connect_to_cartesian. It checks if</span>
<span class="sd">        set of transformation equations create orthogonal curvilinear</span>
<span class="sd">        coordinate system</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        equations : Lambda</span>
<span class="sd">            Lambda of transformation equations</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x1, x2, x3&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">Dummy</span><span class="p">)</span>
        <span class="n">equations</span> <span class="o">=</span> <span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">),</span>
                     <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x1</span><span class="p">),</span> <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x1</span><span class="p">)])</span>

        <span class="n">v2</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x2</span><span class="p">),</span>
                     <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x2</span><span class="p">),</span> <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x2</span><span class="p">)])</span>

        <span class="n">v3</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x3</span><span class="p">),</span>
                     <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x3</span><span class="p">),</span> <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x3</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">simplify</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">simplify</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> \
                <span class="ow">and</span> <span class="n">simplify</span><span class="p">(</span><span class="n">v3</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_set_inv_trans_equations</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store information about inverse transformation equations for</span>
<span class="sd">        pre-defined coordinate systems.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        curv_coord_name : str</span>
<span class="sd">            Name of coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cartesian&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">acos</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span>
                <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cylindrical&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                <span class="n">z</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong set of parameters.&#39;</span>
                         <span class="s1">&#39;Type of coordinate system is defined&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_inv_trans_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method for set_coordinate_type. It calculates inverse</span>
<span class="sd">        transformation equations for given transformations equations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x1, x2, x3&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">Dummy</span><span class="p">,</span> <span class="n">reals</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;x, y, z&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">Dummy</span><span class="p">)</span>

        <span class="n">equations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformation</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="n">solve</span><span class="p">([</span><span class="n">equations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span>
                            <span class="n">equations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span>
                            <span class="n">equations</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">],</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">),</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">solved</span> <span class="o">=</span> <span class="n">solved</span><span class="p">[</span><span class="n">x1</span><span class="p">],</span> <span class="n">solved</span><span class="p">[</span><span class="n">x2</span><span class="p">],</span> <span class="n">solved</span><span class="p">[</span><span class="n">x3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_transformation_from_parent_lambda</span> <span class="o">=</span> \
                <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">))))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">solved</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong set of parameters.&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_lame_coeff</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store information about Lame coefficients for pre-defined</span>
<span class="sd">        coordinate systems.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        curv_coord_name : str</span>
<span class="sd">            Name of coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cartesian&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">:</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cylindrical&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong set of parameters.&#39;</span>
                             <span class="s1">&#39; Type of coordinate system is not defined&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_calculate_lame_coefficients</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calculate_lame_coeff</span><span class="p">(</span><span class="n">equations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It calculates Lame coefficients</span>
<span class="sd">        for given transformations equations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        equations : Lambda</span>
<span class="sd">            Lambda of transformation equations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">:</span> <span class="p">(</span>
                          <span class="n">sqrt</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                          <span class="n">sqrt</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                          <span class="n">sqrt</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                               <span class="n">diff</span><span class="p">(</span><span class="n">equations</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                      <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_inverse_rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns inverse rotation matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">simplify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span><span class="o">**-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_transformation_lambdas</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store information about transformation equations for pre-defined</span>
<span class="sd">        coordinate systems.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        curv_coord_name : str</span>
<span class="sd">            Name of coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">curv_coord_name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cartesian&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
                    <span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
                    <span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">curv_coord_name</span> <span class="o">==</span> <span class="s1">&#39;cylindrical&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">r</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                    <span class="n">r</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                    <span class="n">h</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong set of parameters.&#39;</span>
                             <span class="s1">&#39;Type of coordinate system is defined&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_rotation_trans_equations</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">equations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the transformation equations obtained from rotation matrix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        matrix : Matrix</span>
<span class="sd">            Rotation matrix</span>

<span class="sd">        equations : tuple</span>
<span class="sd">            Transformation equations</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">matrix</span> <span class="o">*</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">equations</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">origin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SymPyDeprecationWarning</span><span class="p">(</span>
            <span class="n">feature</span><span class="o">=</span><span class="s2">&quot;coord_system.delop has been replaced.&quot;</span><span class="p">,</span>
            <span class="n">useinstead</span><span class="o">=</span><span class="s2">&quot;Use the Del() class&quot;</span><span class="p">,</span>
            <span class="n">deprecated_since_version</span><span class="o">=</span><span class="s2">&quot;1.1&quot;</span><span class="p">,</span>
            <span class="n">issue</span><span class="o">=</span><span class="mi">12866</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">warn</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">sympy.vector.deloperator</span> <span class="k">import</span> <span class="n">Del</span>
        <span class="k">return</span> <span class="n">Del</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">base_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_vectors</span>

    <span class="k">def</span> <span class="nf">base_scalars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_scalars</span>

    <span class="k">def</span> <span class="nf">lame_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lame_coefficients</span>

    <span class="k">def</span> <span class="nf">transformation_to_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformation_lambda</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scalars</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">transformation_from_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;no parent coordinate system, use &quot;</span>
                             <span class="s2">&quot;`transformation_from_parent_function()`&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformation_from_parent_lambda</span><span class="p">(</span>
                            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">base_scalars</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">transformation_from_parent_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transformation_from_parent_lambda</span>

<div class="viewcode-block" id="CoordSys3D.rotation_matrix"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.rotation_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the direction cosine matrix(DCM), also known as the</span>
<span class="sd">        &#39;rotation matrix&#39; of this coordinate system with respect to</span>
<span class="sd">        another system.</span>

<span class="sd">        If v_a is a vector defined in system &#39;A&#39; (in matrix format)</span>
<span class="sd">        and v_b is the same vector defined in system &#39;B&#39;, then</span>
<span class="sd">        v_a = A.rotation_matrix(B) * v_b.</span>

<span class="sd">        A SymPy Matrix is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        other : CoordSys3D</span>
<span class="sd">            The system which the DCM is generated to.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1 = symbols(&#39;q1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A = N.orient_new_axis(&#39;A&#39;, q1, N.i)</span>
<span class="sd">        &gt;&gt;&gt; N.rotation_matrix(A)</span>
<span class="sd">        Matrix([</span>
<span class="sd">        [1,       0,        0],</span>
<span class="sd">        [0, cos(q1), -sin(q1)],</span>
<span class="sd">        [0, sin(q1),  cos(q1)]])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sympy.vector.functions</span> <span class="k">import</span> <span class="n">_path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">CoordSys3D</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">+</span>
                            <span class="s2">&quot; is not a CoordSys3D&quot;</span><span class="p">)</span>
        <span class="c1"># Handle special cases</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span>
        <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">_parent</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># Else, use tree to calculate position</span>
        <span class="n">rootindex</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rootindex</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">*=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">*=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_parent_rotation_matrix</span><span class="o">.</span><span class="n">T</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="CoordSys3D.position_wrt"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.position_wrt">[docs]</a>    <span class="nd">@cacheit</span>
    <span class="k">def</span> <span class="nf">position_wrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the position vector of the origin of this coordinate</span>
<span class="sd">        system with respect to another Point/CoordSys3D.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        other : Point/CoordSys3D</span>
<span class="sd">            If other is a Point, the position of this system&#39;s origin</span>
<span class="sd">            wrt it is returned. If its an instance of CoordSyRect,</span>
<span class="sd">            the position wrt its origin is returned.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N1 = N.locate_new(&#39;N1&#39;, 10 * N.i)</span>
<span class="sd">        &gt;&gt;&gt; N.position_wrt(N1)</span>
<span class="sd">        (-10)*N.i</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">position_wrt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.scalar_map"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.scalar_map">[docs]</a>    <span class="k">def</span> <span class="nf">scalar_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary which expresses the coordinate variables</span>
<span class="sd">        (base scalars) of this frame in terms of the variables of</span>
<span class="sd">        otherframe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        otherframe : CoordSys3D</span>
<span class="sd">            The other system to map the variables to.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import Symbol</span>
<span class="sd">        &gt;&gt;&gt; A = CoordSys3D(&#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; q = Symbol(&#39;q&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = A.orient_new_axis(&#39;B&#39;, q, A.k)</span>
<span class="sd">        &gt;&gt;&gt; A.scalar_map(B)</span>
<span class="sd">        {A.x: B.x*cos(q) - B.y*sin(q), A.y: B.x*sin(q) + B.y*cos(q), A.z: B.z}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">relocated_scalars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">origin_coords</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position_wrt</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">base_scalars</span><span class="p">()):</span>
            <span class="n">relocated_scalars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">origin_coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">vars_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">*</span>
                       <span class="n">Matrix</span><span class="p">(</span><span class="n">relocated_scalars</span><span class="p">))</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_scalars</span><span class="p">()):</span>
            <span class="n">mapping</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">vars_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">mapping</span></div>

<div class="viewcode-block" id="CoordSys3D.locate_new"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.locate_new">[docs]</a>    <span class="k">def</span> <span class="nf">locate_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a CoordSys3D with its origin located at the given</span>
<span class="sd">        position wrt this coordinate system&#39;s origin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : str</span>
<span class="sd">            The name of the new CoordSys3D instance.</span>

<span class="sd">        position : Vector</span>
<span class="sd">            The position vector of the new system&#39;s origin wrt this</span>
<span class="sd">            one.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; A = CoordSys3D(&#39;A&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = A.locate_new(&#39;B&#39;, 10 * A.i)</span>
<span class="sd">        &gt;&gt;&gt; B.origin.position_wrt(A.origin)</span>
<span class="sd">        10*A.i</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variable_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_names</span>
        <span class="k">if</span> <span class="n">vector_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vector_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_names</span>

        <span class="k">return</span> <span class="n">CoordSys3D</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                          <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                          <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">,</span>
                          <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.orient_new"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.orient_new">[docs]</a>    <span class="k">def</span> <span class="nf">orient_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">orienters</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new CoordSys3D oriented in the user-specified way</span>
<span class="sd">        with respect to this system.</span>

<span class="sd">        Please refer to the documentation of the orienter classes</span>
<span class="sd">        for more information about the orientation procedure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : str</span>
<span class="sd">            The name of the new CoordSys3D instance.</span>

<span class="sd">        orienters : iterable/Orienter</span>
<span class="sd">            An Orienter or an iterable of Orienters for orienting the</span>
<span class="sd">            new coordinate system.</span>
<span class="sd">            If an Orienter is provided, it is applied to get the new</span>
<span class="sd">            system.</span>
<span class="sd">            If an iterable is provided, the orienters will be applied</span>
<span class="sd">            in the order in which they appear in the iterable.</span>

<span class="sd">        location : Vector(optional)</span>
<span class="sd">            The location of the new coordinate system&#39;s origin wrt this</span>
<span class="sd">            system&#39;s origin. If not specified, the origins are taken to</span>
<span class="sd">            be coincident.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q0, q1, q2, q3 = symbols(&#39;q0 q1 q2 q3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>

<span class="sd">        Using an AxisOrienter</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import AxisOrienter</span>
<span class="sd">        &gt;&gt;&gt; axis_orienter = AxisOrienter(q1, N.i + 2 * N.j)</span>
<span class="sd">        &gt;&gt;&gt; A = N.orient_new(&#39;A&#39;, (axis_orienter, ))</span>

<span class="sd">        Using a BodyOrienter</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import BodyOrienter</span>
<span class="sd">        &gt;&gt;&gt; body_orienter = BodyOrienter(q1, q2, q3, &#39;123&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = N.orient_new(&#39;B&#39;, (body_orienter, ))</span>

<span class="sd">        Using a SpaceOrienter</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import SpaceOrienter</span>
<span class="sd">        &gt;&gt;&gt; space_orienter = SpaceOrienter(q1, q2, q3, &#39;312&#39;)</span>
<span class="sd">        &gt;&gt;&gt; C = N.orient_new(&#39;C&#39;, (space_orienter, ))</span>

<span class="sd">        Using a QuaternionOrienter</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import QuaternionOrienter</span>
<span class="sd">        &gt;&gt;&gt; q_orienter = QuaternionOrienter(q0, q1, q2, q3)</span>
<span class="sd">        &gt;&gt;&gt; D = N.orient_new(&#39;D&#39;, (q_orienter, ))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variable_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_names</span>
        <span class="k">if</span> <span class="n">vector_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vector_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_names</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orienters</span><span class="p">,</span> <span class="n">Orienter</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orienters</span><span class="p">,</span> <span class="n">AxisOrienter</span><span class="p">):</span>
                <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">orienters</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">orienters</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">()</span>
            <span class="c1"># TODO: trigsimp is needed here so that the matrix becomes</span>
            <span class="c1"># canonical (scalar_map also calls trigsimp; without this, you can</span>
            <span class="c1"># end up with the same CoordinateSystem that compares differently</span>
            <span class="c1"># due to a differently formatted matrix). However, this is</span>
            <span class="c1"># probably not so good for performance.</span>
            <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">trigsimp</span><span class="p">(</span><span class="n">final_matrix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">final_matrix</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">orienter</span> <span class="ow">in</span> <span class="n">orienters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orienter</span><span class="p">,</span> <span class="n">AxisOrienter</span><span class="p">):</span>
                    <span class="n">final_matrix</span> <span class="o">*=</span> <span class="n">orienter</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">final_matrix</span> <span class="o">*=</span> <span class="n">orienter</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">CoordSys3D</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="o">=</span><span class="n">final_matrix</span><span class="p">,</span>
                          <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                          <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">,</span>
                          <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                          <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.orient_new_axis"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.orient_new_axis">[docs]</a>    <span class="k">def</span> <span class="nf">orient_new_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis rotation is a rotation about an arbitrary axis by</span>
<span class="sd">        some angle. The angle is supplied as a SymPy expr scalar, and</span>
<span class="sd">        the axis is supplied as a Vector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : string</span>
<span class="sd">            The name of the new coordinate system</span>

<span class="sd">        angle : Expr</span>
<span class="sd">            The angle by which the new system is to be rotated</span>

<span class="sd">        axis : Vector</span>
<span class="sd">            The axis around which the rotation has to be performed</span>

<span class="sd">        location : Vector(optional)</span>
<span class="sd">            The location of the new coordinate system&#39;s origin wrt this</span>
<span class="sd">            system&#39;s origin. If not specified, the origins are taken to</span>
<span class="sd">            be coincident.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1 = symbols(&#39;q1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = N.orient_new_axis(&#39;B&#39;, q1, N.i + 2 * N.j)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variable_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_names</span>
        <span class="k">if</span> <span class="n">vector_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vector_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_names</span>

        <span class="n">orienter</span> <span class="o">=</span> <span class="n">AxisOrienter</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">orienter</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                               <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                               <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.orient_new_body"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.orient_new_body">[docs]</a>    <span class="k">def</span> <span class="nf">orient_new_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">,</span>
                        <span class="n">rotation_order</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Body orientation takes this coordinate system through three</span>
<span class="sd">        successive simple rotations.</span>

<span class="sd">        Body fixed rotations include both Euler Angles and</span>
<span class="sd">        Tait-Bryan Angles, see http://en.wikipedia.org/wiki/Euler_angles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : string</span>
<span class="sd">            The name of the new coordinate system</span>

<span class="sd">        angle1, angle2, angle3 : Expr</span>
<span class="sd">            Three successive angles to rotate the coordinate system by</span>

<span class="sd">        rotation_order : string</span>
<span class="sd">            String defining the order of axes for rotation</span>

<span class="sd">        location : Vector(optional)</span>
<span class="sd">            The location of the new coordinate system&#39;s origin wrt this</span>
<span class="sd">            system&#39;s origin. If not specified, the origins are taken to</span>
<span class="sd">            be coincident.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1, q2, q3 = symbols(&#39;q1 q2 q3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>

<span class="sd">        A &#39;Body&#39; fixed rotation is described by three angles and</span>
<span class="sd">        three body-fixed rotation axes. To orient a coordinate system D</span>
<span class="sd">        with respect to N, each sequential rotation is always about</span>
<span class="sd">        the orthogonal unit vectors fixed to D. For example, a &#39;123&#39;</span>
<span class="sd">        rotation will specify rotations about N.i, then D.j, then</span>
<span class="sd">        D.k. (Initially, D.i is same as N.i)</span>
<span class="sd">        Therefore,</span>

<span class="sd">        &gt;&gt;&gt; D = N.orient_new_body(&#39;D&#39;, q1, q2, q3, &#39;123&#39;)</span>

<span class="sd">        is same as</span>

<span class="sd">        &gt;&gt;&gt; D = N.orient_new_axis(&#39;D&#39;, q1, N.i)</span>
<span class="sd">        &gt;&gt;&gt; D = D.orient_new_axis(&#39;D&#39;, q2, D.j)</span>
<span class="sd">        &gt;&gt;&gt; D = D.orient_new_axis(&#39;D&#39;, q3, D.k)</span>

<span class="sd">        Acceptable rotation orders are of length 3, expressed in XYZ or</span>
<span class="sd">        123, and cannot have a rotation about about an axis twice in a row.</span>

<span class="sd">        &gt;&gt;&gt; B = N.orient_new_body(&#39;B&#39;, q1, q2, q3, &#39;123&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = N.orient_new_body(&#39;B&#39;, q1, q2, 0, &#39;ZXZ&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = N.orient_new_body(&#39;B&#39;, 0, 0, 0, &#39;XYX&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orienter</span> <span class="o">=</span> <span class="n">BodyOrienter</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">,</span> <span class="n">rotation_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">orienter</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                               <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                               <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.orient_new_space"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.orient_new_space">[docs]</a>    <span class="k">def</span> <span class="nf">orient_new_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">,</span>
                         <span class="n">rotation_order</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Space rotation is similar to Body rotation, but the rotations</span>
<span class="sd">        are applied in the opposite order.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : string</span>
<span class="sd">            The name of the new coordinate system</span>

<span class="sd">        angle1, angle2, angle3 : Expr</span>
<span class="sd">            Three successive angles to rotate the coordinate system by</span>

<span class="sd">        rotation_order : string</span>
<span class="sd">            String defining the order of axes for rotation</span>

<span class="sd">        location : Vector(optional)</span>
<span class="sd">            The location of the new coordinate system&#39;s origin wrt this</span>
<span class="sd">            system&#39;s origin. If not specified, the origins are taken to</span>
<span class="sd">            be coincident.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        See Also</span>
<span class="sd">        ========</span>

<span class="sd">        CoordSys3D.orient_new_body : method to orient via Euler</span>
<span class="sd">            angles</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q1, q2, q3 = symbols(&#39;q1 q2 q3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>

<span class="sd">        To orient a coordinate system D with respect to N, each</span>
<span class="sd">        sequential rotation is always about N&#39;s orthogonal unit vectors.</span>
<span class="sd">        For example, a &#39;123&#39; rotation will specify rotations about</span>
<span class="sd">        N.i, then N.j, then N.k.</span>
<span class="sd">        Therefore,</span>

<span class="sd">        &gt;&gt;&gt; D = N.orient_new_space(&#39;D&#39;, q1, q2, q3, &#39;312&#39;)</span>

<span class="sd">        is same as</span>

<span class="sd">        &gt;&gt;&gt; B = N.orient_new_axis(&#39;B&#39;, q1, N.i)</span>
<span class="sd">        &gt;&gt;&gt; C = B.orient_new_axis(&#39;C&#39;, q2, N.j)</span>
<span class="sd">        &gt;&gt;&gt; D = C.orient_new_axis(&#39;D&#39;, q3, N.k)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orienter</span> <span class="o">=</span> <span class="n">SpaceOrienter</span><span class="p">(</span><span class="n">angle1</span><span class="p">,</span> <span class="n">angle2</span><span class="p">,</span> <span class="n">angle3</span><span class="p">,</span> <span class="n">rotation_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">orienter</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                               <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                               <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.orient_new_quaternion"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.orient_new_quaternion">[docs]</a>    <span class="k">def</span> <span class="nf">orient_new_quaternion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quaternion orientation orients the new CoordSys3D with</span>
<span class="sd">        Quaternions, defined as a finite rotation about lambda, a unit</span>
<span class="sd">        vector, by some amount theta.</span>

<span class="sd">        This orientation is described by four parameters:</span>

<span class="sd">        q0 = cos(theta/2)</span>

<span class="sd">        q1 = lambda_x sin(theta/2)</span>

<span class="sd">        q2 = lambda_y sin(theta/2)</span>

<span class="sd">        q3 = lambda_z sin(theta/2)</span>

<span class="sd">        Quaternion does not take in a rotation order.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : string</span>
<span class="sd">            The name of the new coordinate system</span>

<span class="sd">        q0, q1, q2, q3 : Expr</span>
<span class="sd">            The quaternions to rotate the coordinate system by</span>

<span class="sd">        location : Vector(optional)</span>
<span class="sd">            The location of the new coordinate system&#39;s origin wrt this</span>
<span class="sd">            system&#39;s origin. If not specified, the origins are taken to</span>
<span class="sd">            be coincident.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; from sympy import symbols</span>
<span class="sd">        &gt;&gt;&gt; q0, q1, q2, q3 = symbols(&#39;q0 q1 q2 q3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; N = CoordSys3D(&#39;N&#39;)</span>
<span class="sd">        &gt;&gt;&gt; B = N.orient_new_quaternion(&#39;B&#39;, q0, q1, q2, q3)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">orienter</span> <span class="o">=</span> <span class="n">QuaternionOrienter</span><span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orient_new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">orienter</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                               <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">,</span>
                               <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.create_new"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.create_new">[docs]</a>    <span class="k">def</span> <span class="nf">create_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a CoordSys3D which is connected to self by transformation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>

<span class="sd">        name : str</span>
<span class="sd">            The name of the new CoordSys3D instance.</span>

<span class="sd">        transformation : Lambda, Tuple, str</span>
<span class="sd">            Transformation defined by transformation equations or chosen</span>
<span class="sd">            from predefined ones.</span>

<span class="sd">        vector_names, variable_names : iterable(optional)</span>
<span class="sd">            Iterables of 3 strings each, with custom names for base</span>
<span class="sd">            vectors and base scalars of the new system respectively.</span>
<span class="sd">            Used for simple str printing.</span>

<span class="sd">        Examples</span>
<span class="sd">        ========</span>

<span class="sd">        &gt;&gt;&gt; from sympy.vector import CoordSys3D</span>
<span class="sd">        &gt;&gt;&gt; a = CoordSys3D(&#39;a&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b = a.create_new(&#39;b&#39;, transformation=&#39;spherical&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b.transformation_to_parent()</span>
<span class="sd">        (b.r*sin(b.theta)*cos(b.phi), b.r*sin(b.phi)*sin(b.theta), b.r*cos(b.theta))</span>
<span class="sd">        &gt;&gt;&gt; b.transformation_from_parent()</span>
<span class="sd">        (sqrt(a.x**2 + a.y**2 + a.z**2), acos(a.z/sqrt(a.x**2 + a.y**2 + a.z**2)), atan2(a.y, a.x))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CoordSys3D</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="n">transformation</span><span class="p">,</span>
                          <span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">,</span> <span class="n">vector_names</span><span class="o">=</span><span class="n">vector_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CoordSys3D.__init__"><a class="viewcode-back" href="../../../modules/vector/api/classes.html#sympy.vector.coordsysrect.CoordSys3D.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">latex_vects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pretty_vects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latex_scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pretty_scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Dummy initializer for setting docstring</span>
        <span class="k">pass</span></div>

    <span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="fm">__new__</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compose_rotation_and_translation</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">CoordSys3D</span><span class="o">.</span><span class="n">_rotation_trans_equations</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span>

        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="p">[</span><span class="n">translation</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">base_vectors</span><span class="p">()]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span>
            <span class="n">z</span> <span class="o">+</span> <span class="n">dz</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">t</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_check_strings</span><span class="p">(</span><span class="n">arg_name</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="n">errorstr</span> <span class="o">=</span> <span class="n">arg_name</span> <span class="o">+</span> <span class="s2">&quot; must be an iterable of 3 string-types&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errorstr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errorstr</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SymPy 1.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018 SymPy Development Team.
      Last updated on Sep 14, 2018.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.0.
    </div>
  </body>
</html>